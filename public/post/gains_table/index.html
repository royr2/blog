<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="hugo-theme" content="Axiom 0.8.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/">
  <link rel="icon" type="image/x-icon" href="/">
  <link rel="apple-touch-icon" href="/">
  <link rel="canonical" href="https://rtichoke.netlify.app/post/gains_table/">
<link rel="preload" as="style" href="/bundle.css?v=1631939995" media="all">
<link rel="stylesheet" href="/bundle.css?v=1631939995" media="all">
<style>.cdata pre{background-color:#1f2937;color:#e5e7eb}.cdata :not(pre)>code{background-color:#f3f4f6;color:#7c3aed}.chroma .err{background-color:#991b1b;color:#fecaca}.chroma .hl{background-color:#374151}.chroma .ln{color:#9ca3af}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#60a5fa}.chroma .kt{color:#a78bfa}.chroma .na,.chroma .nb{color:#fbbf24}.chroma .nc{color:#f87171}.chroma .no{color:#34d399}.chroma .nd{color:#f87171}.chroma .ne{color:#f87171}.chroma .nf{color:#fbbf24}.chroma .nt{color:#f87171}.chroma .l{color:#a78bfa}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#34d399}.chroma .se{color:#9ca3af}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#34d399}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#a78bfa}.chroma .o,.chroma .ow{color:#93c5fd}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs,.chroma .p{color:#9ca3af}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}
</style>



<title>Measuring model performance using a gains table : R&#39;tichoke</title>

<meta property="og:title" content="Measuring model performance using a gains table">
<meta property="og:site_name" content="R&#39;tichoke">
<meta property="og:url" content="https://rtichoke.netlify.app/post/gains_table/">
<link rel="image_src" href="https://rtichoke.netlify.app/">
<meta property="og:image" content="https://rtichoke.netlify.app/">
<meta property="og:image:width" content="">
<meta property="og:image:height" content="">
<meta property="og:type" content="article">
<meta property="og:locale" content="en_us">
<meta property="og:description" content="How to create a gains table to measure the performance of a binary classification model">
<meta name="description" content="How to create a gains table to measure the performance of a binary classification model">
<meta property="og:updated_time" content="2021-09-06T00:00:00Z">
<meta property="fb:app_id" content="">
<meta name="author" content="Riddhiman">
<meta property="article:author" content="https://linkedin.com/in/riddhimanr">
<meta property="article:published_time" content="2021-09-06T00:00:00Z">
<meta property="article:modified_time" content="2021-09-06T00:00:00Z">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Measuring model performance using a gains table",
  "alternativeHeadline": "Credit risk series (Post #1)",
  "url": "https://rtichoke.netlify.app/post/gains_table/",
  "image": "https://rtichoke.netlify.app/",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rtichoke.netlify.app/post/gains_table/"
  },
  "description": "How to create a gains table to measure the performance of a binary classification model",
  "author": {
    "@type": "Person",
    "name": "Riddhiman"
  },
  "publisher": {
    "@type": "Organization",
    "name": "R'tichoke",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rtichoke.netlify.app/"
    }
  },
  "datePublished": "2021-09-06T00:00:00Z",
  "dateModified": "2021-09-06T00:00:00Z",
  "articleBody": "\u003cp\u003eModellers/analysts developing credit scores generally use something known as the \u003ccode\u003egains table\u003c/code\u003e (or a \u003ccode\u003eks table\u003c/code\u003e) to measure and quantify the performance of such models. We\u0026rsquo;ll explore how to build such a table in this post.\u003c/p\u003e\n\u003cp\u003eThe idea is to first discretise the population under consideration (say the testing or validation set) into groups based on the model\u0026rsquo;s output (probability/log odds/scores). Typically, this is done in a way such that each group represents 10% of the total population (or deciles). Then, summary statistics are generated for each group and  cumulative distributions of events and non-events are analysed and the model\u0026rsquo;s performance is quantified.\u003c/p\u003e\n\u003cp\u003eWe\u0026rsquo;ll use \u003ccode\u003edplyr\u003c/code\u003e in this post. Doing it this way is nice since it\u0026rsquo;s easier to read and the code would need minimal changes if using \u003ccode\u003esparklyr\u003c/code\u003e (say within a big data environment where one might need to run this directly on a \u003cem\u003ehadoop\u003c/em\u003e table).\u003c/p\u003e\n\u003ch2 id=\"packages\"\u003ePackages\u003c/h2\u003e\n\u003cp\u003eLet\u0026rsquo;s get package installation out of the way first.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Pacman is a package management tool \u003c/span\u003e\n\u003cspan style=\"color:#a6e22e\"\u003einstall.packages\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pacman\u0026#34;\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(pacman)\n\u003cspan style=\"color:#75715e\"\u003e## Warning: package \u0026#39;pacman\u0026#39; was built under R version 4.1.1\u003c/span\u003e\n\n\u003cspan style=\"color:#75715e\"\u003e# p_load automatically installs packages if needed\u003c/span\u003e\n\u003cspan style=\"color:#a6e22e\"\u003ep_load\u003c/span\u003e(dplyr, magrittr, knitr, scales)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"sample-dataset\"\u003eSample dataset\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/royr2/blog/blob/main/download/credit_sample.csv\"\u003eHere\u0026rsquo;s\u003c/a\u003e some sample data to play around with. The data set is small sample of the \u003cstrong\u003eLending Club\u003c/strong\u003e dataset available on \u003ca href=\"https://www.kaggle.com/wordsforthewise/lending-club\"\u003eKaggle\u003c/a\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003esample \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eread.csv\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;credit_sample.csv\u0026#34;\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(sample)\n\u003cspan style=\"color:#75715e\"\u003e## [1] 10000   153\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e(sample)\n\u003cspan style=\"color:#75715e\"\u003e## [1] \u0026#34;data.frame\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"defining-a-target\"\u003eDefining a target\u003c/h2\u003e\n\u003cp\u003eFirst, we need to create a target (outcome) to model for. Since this is a credit risk use case, we are looking to create a target which identifies borrowers who defaulted on (or missed) their payments consecutively.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#a6e22e\"\u003eunique\u003c/span\u003e(sample\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eloan_status)\n\u003cspan style=\"color:#75715e\"\u003e## [1] \u0026#34;Fully Paid\u0026#34;                                         \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## [2] \u0026#34;Current\u0026#34;                                            \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## [3] \u0026#34;Charged Off\u0026#34;                                        \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## [4] \u0026#34;Late (31-120 days)\u0026#34;                                 \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## [5] \u0026#34;Late (16-30 days)\u0026#34;                                  \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## [6] \u0026#34;In Grace Period\u0026#34;                                    \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## [7] \u0026#34;Does not meet the credit policy. Status:Fully Paid\u0026#34; \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## [8] \u0026#34;Does not meet the credit policy. Status:Charged Off\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# For simplicity we\u0026#39;ll just use \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e# 1. \u0026#34;Charged Off\u0026#34;\u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e# 2. \u0026#34;Does not meet the credit policy. Status:Charged Off\u0026#34;\u003c/span\u003e\ncodes \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Charged Off\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Does not meet the credit policy. Status:Charged Off\u0026#34;\u003c/span\u003e)\n\n\u003cspan style=\"color:#75715e\"\u003e# For details on the %\u0026lt;\u0026gt;% operator please look at the \u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e# documentation for the magrittr package. \u003c/span\u003e\nsample \u003cspan style=\"color:#f92672\"\u003e%\u0026lt;\u0026gt;%\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(bad_flag \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eifelse\u003c/span\u003e(loan_status \u003cspan style=\"color:#f92672\"\u003e%in%\u003c/span\u003e codes, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e))\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s also check for overall event rates.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003esample \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n  \u003cspan style=\"color:#a6e22e\"\u003esummarise\u003c/span\u003e(events \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(bad_flag \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e), \n            non_events \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(bad_flag \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n  \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(event_rate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e events\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e(events \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e non_events))\n\u003cspan style=\"color:#75715e\"\u003e##   events non_events event_rate\u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e## 1   1162       8838     0.1162\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"building-a-model\"\u003eBuilding a model\u003c/h2\u003e\n\u003cp\u003eNext lets build a quick and dirty model, the output of which we will use to build the gains table.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Check out available features (not shown here for brevity)\u003c/span\u003e\n\u003cspan style=\"color:#a6e22e\"\u003ecolnames\u003c/span\u003e(sample)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe\u0026rsquo;ll need to do some data cleaning first.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Replace all NA values with a default value\u003c/span\u003e\nsample\u003cspan style=\"color:#a6e22e\"\u003e[is.na\u003c/span\u003e(sample)] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e-1\u003c/span\u003e\n\nsample \u003cspan style=\"color:#f92672\"\u003e%\u0026lt;\u0026gt;%\u003c/span\u003e \n  \n  \u003cspan style=\"color:#75715e\"\u003e# Remove cases where home ownership and payment plan are not reported\u003c/span\u003e\n  \u003cspan style=\"color:#a6e22e\"\u003efilter\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e home_ownership \u003cspan style=\"color:#f92672\"\u003e%in%\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;NONE\u0026#34;\u003c/span\u003e),\n         pymnt_plan \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n  \n  \u003cspan style=\"color:#75715e\"\u003e# Convert these two variables into factors\u003c/span\u003e\n  \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(home_ownership \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efactor\u003c/span\u003e(home_ownership), \n         pymnt_plan \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efactor\u003c/span\u003e(pymnt_plan))\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Train Test split\u003c/span\u003e\nidx \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esample\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(sample), size \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.7\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(sample), replace \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e F)\ntrain \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e sample[idx,]\ntest \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e sample[\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003eidx,]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(train)\n\u003cspan style=\"color:#75715e\"\u003e## [1] 6999  153\u003c/span\u003e\n\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(test)\n\u003cspan style=\"color:#75715e\"\u003e## [1] 3000  153\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Using a GLM model for simplicity\u003c/span\u003e\nmdl \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eglm\u003c/span\u003e(\n  formula \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bad_flag \u003cspan style=\"color:#f92672\"\u003e~\u003c/span\u003e \n    loan_amnt \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e term \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e mths_since_last_delinq \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e total_pymnt \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n    home_ownership \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e acc_now_delinq \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n    inq_last_6mths \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e delinq_amnt \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n    mths_since_last_record \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e mths_since_recent_revol_delinq \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n    mths_since_last_major_derog \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e mths_since_recent_inq \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n    mths_since_recent_bc \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e num_accts_ever_120_pd,\n  family \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;binomial\u0026#34;\u003c/span\u003e, \n  data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e train\n)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhile we are at it, let\u0026rsquo;s also attach the model predictions to the test dataset.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003etest\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003epred \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epredict\u003c/span\u003e(mdl, newdata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e test)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"creating-the-gains-table\"\u003eCreating the Gains Table\u003c/h2\u003e\n\u003cp\u003eThe table has a few important components:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBins in decreasing/increasing order of model output (probability/log odds/scores)\u003c/li\u003e\n\u003cli\u003ePopulation percentages contained in each bin\u003c/li\u003e\n\u003cli\u003eObserved event rates in each bin\u003c/li\u003e\n\u003cli\u003eCumulative events and non events distributions\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Discretise predictions based on quantiles\u003c/span\u003e\nq \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equantile\u003c/span\u003e(test\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003epred, probs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eseq\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, length.out \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e))\n\n\u003cspan style=\"color:#75715e\"\u003e# Add bins to test dataset\u003c/span\u003e\ntest\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ebins \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecut\u003c/span\u003e(test\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003epred, breaks \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e q, include.lowest \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e T, right \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e T, ordered_result \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e T)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"flex items-center justify-center font-content-sans rounded bg-raven-100 px-4 py-4\" role=\"alert\"\u003e\n  \u003cspan class=\"text-xs font-bold uppercase leading-none rounded-full text-raven-100 bg-raven-500 px-2 py-1 mr-3\"\u003einfo\u003c/span\u003e\n  \u003cspan class=\"font-semibold text-raven-700\"\u003eNote that the output from cut is arranged in increasing order of value\u003c/span\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#a6e22e\"\u003elevels\u003c/span\u003e(test\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ebins)\n\u003cspan style=\"color:#75715e\"\u003e##  [1] \u0026#34;[-5.27,-3.52]\u0026#34; \u0026#34;(-3.52,-3]\u0026#34;    \u0026#34;(-3,-2.72]\u0026#34;    \u0026#34;(-2.72,-2.48]\u0026#34;\u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e##  [5] \u0026#34;(-2.48,-2.29]\u0026#34; \u0026#34;(-2.29,-2.1]\u0026#34;  \u0026#34;(-2.1,-1.89]\u0026#34;  \u0026#34;(-1.89,-1.65]\u0026#34;\u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e##  [9] \u0026#34;(-1.65,-1.29]\u0026#34; \u0026#34;(-1.29,12.8]\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUsing the bins we created above, we can now start to put the table together\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Start with the test dataset and summarise\u003c/span\u003e\ngains_table \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e test \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n  \u003cspan style=\"color:#a6e22e\"\u003egroup_by\u003c/span\u003e(bins) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n  \u003cspan style=\"color:#a6e22e\"\u003esummarise\u003c/span\u003e(total \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e(), \n            events \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(bad_flag \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e), \n            non_events \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(bad_flag \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e))\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAt this point the table should look something like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#a6e22e\"\u003ekable\u003c/span\u003e(gains_table)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ebins\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003etotal\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003eevents\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003enon_events\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e[-5.27,-3.52]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e290\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3.52,-3]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e292\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3,-2.72]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e287\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.72,-2.48]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e280\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.48,-2.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e26\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e274\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.29,-2.1]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e37\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e263\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.1,-1.89]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e54\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e246\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.89,-1.65]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e57\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e243\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.65,-1.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e64\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e236\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.29,12.8]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e71\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e229\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eNext, we\u0026rsquo;ll add the event rate columns. Let\u0026rsquo;s also make the table presentable - I\u0026rsquo;ll use the \u003ccode\u003epercent()\u003c/code\u003e function in the \u003ccode\u003escales\u003c/code\u003e package to show numbers as percentages.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003egains_table \u003cspan style=\"color:#f92672\"\u003e%\u0026lt;\u0026gt;%\u003c/span\u003e\n  \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(event_rate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(events \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e total, \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e))\n\n\u003cspan style=\"color:#a6e22e\"\u003ekable\u003c/span\u003e(gains_table)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ebins\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003etotal\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003eevents\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003enon_events\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eevent_rate\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e[-5.27,-3.52]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e290\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3.3%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3.52,-3]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e292\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2.7%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3,-2.72]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e287\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e4.3%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.72,-2.48]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e280\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e6.7%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.48,-2.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e26\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e274\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e8.7%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.29,-2.1]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e37\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e263\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e12.3%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.1,-1.89]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e54\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e246\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e18.0%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.89,-1.65]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e57\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e243\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19.0%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.65,-1.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e64\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e236\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21.3%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.29,12.8]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e71\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e229\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e23.7%\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eTo this we\u0026rsquo;ll add some columns quantifying how events and non events are distributed across each bin.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003egains_table \u003cspan style=\"color:#f92672\"\u003e%\u0026lt;\u0026gt;%\u003c/span\u003e\n  \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(pop_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(total\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(total), \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), \n         \n         \u003cspan style=\"color:#75715e\"\u003e# Not formatting these as percentages just yet\u003c/span\u003e\n         c.events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(events) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(events),\n         c.non_events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(non_events) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(non_events))\n\n\u003cspan style=\"color:#a6e22e\"\u003ekable\u003c/span\u003e(gains_table) \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ebins\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003etotal\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003eevents\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003enon_events\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eevent_rate\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003epop_pct\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ec.events_pct\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ec.non_events_pct\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e[-5.27,-3.52]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e290\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.0277778\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.1098485\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3.52,-3]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e292\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.0500000\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.2204545\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3,-2.72]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e287\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e4.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.0861111\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.3291667\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.72,-2.48]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e280\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e6.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.1416667\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.4352273\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.48,-2.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e26\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e274\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e8.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.2138889\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.5390152\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.29,-2.1]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e37\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e263\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e12.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.3166667\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.6386364\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.1,-1.89]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e54\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e246\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e18.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.4666667\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.7318182\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.89,-1.65]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e57\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e243\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.6250000\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.8238636\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.65,-1.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e64\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e236\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.8027778\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.9132576\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.29,12.8]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e71\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e229\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e23.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1.0000000\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1.0000000\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eAlmost done - just need a few more columns namely:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA column computing the difference between the two cumulative distribution columns we created previously. The maximum value of this column will become the primary performance metric known as the \u003ccode\u003eKS statistic\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eTwo additional columns computing \u003ccode\u003eevent capture rates\u003c/code\u003e and \u003ccode\u003ecumulative event rates\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003egains_table \u003cspan style=\"color:#f92672\"\u003e%\u0026lt;\u0026gt;%\u003c/span\u003e\n  \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(ks \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eround\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eabs\u003c/span\u003e(c.events_pct \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e c.non_events_pct), \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e), \n         cap_rate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(events)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(events), \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), \n         c_event_rate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(events)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(total), \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), \n         \n         \u003cspan style=\"color:#75715e\"\u003e# Format pending columns\u003c/span\u003e\n         c.events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(c.events_pct, \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e),\n         c.non_events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(c.non_events_pct, \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e))\n\n\u003cspan style=\"color:#a6e22e\"\u003ekable\u003c/span\u003e(gains_table)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ebins\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003etotal\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003eevents\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003enon_events\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eevent_rate\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003epop_pct\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ec.events_pct\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ec.non_events_pct\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003eks\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ecap_rate\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ec_event_rate\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e[-5.27,-3.52]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e290\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2.8%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e11.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.08\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3.3%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3.52,-3]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e292\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e5.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e22.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.17\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e5%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3.0%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3,-2.72]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e287\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e4.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e8.6%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e32.9%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.24\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e9%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3.4%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.72,-2.48]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e280\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e6.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e14.2%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e43.5%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.29\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e14%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e4.2%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.48,-2.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e26\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e274\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e8.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21.4%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e53.9%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.33\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e5.1%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.29,-2.1]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e37\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e263\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e12.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e31.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e63.9%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.32\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e32%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e6.3%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.1,-1.89]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e54\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e246\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e18.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e46.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e73.2%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.27\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e47%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e8.0%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.89,-1.65]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e57\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e243\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e62.5%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e82.4%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.20\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e62%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e9.4%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.65,-1.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e64\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e236\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e80.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e91.3%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.11\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e80%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.7%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.29,12.8]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e71\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e229\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e23.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e100.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e100.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e100%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e12.0%\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"creating-a-function\"\u003eCreating a function\u003c/h2\u003e\n\u003cp\u003eFinally, we can encapsulate all of the above code in a single function. Note that we actually do not need the full test/train dataset, just the actual classes and predicted outcomes (log odds/probability/score).\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003egains_table \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunction\u003c/span\u003e(act, pred, increasing \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e T, nBins \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e){\n  \n  q \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equantile\u003c/span\u003e(pred, probs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eseq\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, length.out \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e nBins \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e))\n  bins \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecut\u003c/span\u003e(pred, breaks \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e q, include.lowest \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e T, right \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e T, ordered_result \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e T)\n  \n  df \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata.frame\u003c/span\u003e(act, pred, bins)\n  \n  df \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n    \n    \u003cspan style=\"color:#a6e22e\"\u003egroup_by\u003c/span\u003e(bins) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n    \u003cspan style=\"color:#a6e22e\"\u003esummarise\u003c/span\u003e(total \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003en\u003c/span\u003e(), \n              events \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(act \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e), \n              non_events \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(act \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n    \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(event_rate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(events \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e total, \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e)) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n    \n    \u003cspan style=\"color:#75715e\"\u003e# This odd looking format is to ensure that the if-else \u003c/span\u003e\n    \u003cspan style=\"color:#75715e\"\u003e# condition is part of the dplyr chain\u003c/span\u003e\n    {\u003cspan style=\"color:#a6e22e\"\u003eif\u003c/span\u003e(increasing \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e){\n      \u003cspan style=\"color:#a6e22e\"\u003earrange\u003c/span\u003e(., bins)\n    }else{\n      \u003cspan style=\"color:#a6e22e\"\u003earrange\u003c/span\u003e(., \u003cspan style=\"color:#a6e22e\"\u003edesc\u003c/span\u003e(bins))\n    }} \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n    \n    \u003cspan style=\"color:#a6e22e\"\u003emutate\u003c/span\u003e(pop_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(total\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(total), \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), \n           c.events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(events) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(events),\n           c.non_events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(non_events) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(non_events), \n           ks \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eround\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eabs\u003c/span\u003e(c.events_pct \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e c.non_events_pct), \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e), \n           cap_rate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(events)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esum\u003c/span\u003e(events), \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), \n           c_event_rate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(events)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecumsum\u003c/span\u003e(total), \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), \n           c.events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(c.events_pct, \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e),\n           c.non_events_pct \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epercent\u003c/span\u003e(c.non_events_pct, \u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e))\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIt is worth noting here that since the capture rate is being computed from \u003cstrong\u003etop to bottom\u003c/strong\u003e, it is important that the table is arranged in an appropriate manner. That is, when modelling for \u003ccode\u003ebads\u003c/code\u003e, the table should be arrange in \u003cstrong\u003edescending\u003c/strong\u003e order of the model output (i.e. higher event rates at the top) and vice versa.\u003c/p\u003e\n\u003cp\u003eAlso, if you are planning on using this with \u003ccode\u003esparklyr\u003c/code\u003e, consider looking into the \u003ccode\u003eft_quantile_discretizer()\u003c/code\u003e function. It would replace \u003ccode\u003ecut()\u003c/code\u003e here.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"color:#75715e\"\u003e# Test the function\u003c/span\u003e\ntab \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egains_table\u003c/span\u003e(test\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ebad_flag, test\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003epred, F, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e)\n\u003cspan style=\"color:#a6e22e\"\u003ekable\u003c/span\u003e(tab)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ebins\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003etotal\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003eevents\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003enon_events\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eevent_rate\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003epop_pct\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ec.events_pct\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ec.non_events_pct\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003eks\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ecap_rate\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ec_event_rate\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.29,12.8]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e71\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e229\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e23.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e8.7%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.11\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e20%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e23.7%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.65,-1.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e64\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e236\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e37.5%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e17.6%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.20\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e38%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e22.5%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-1.89,-1.65]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e57\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e243\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e53.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e26.8%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.27\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e53%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21.3%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.1,-1.89]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e54\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e246\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e18.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e68.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e36.1%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.32\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e68%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e20.5%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.29,-2.1]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e37\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e263\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e12.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e78.6%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e46.1%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.33\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e79%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e18.9%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.48,-2.29]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e26\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e274\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e8.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e85.8%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e56.5%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.29\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e86%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e17.2%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-2.72,-2.48]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e280\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e6.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e91.4%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e67.1%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.24\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e91%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e15.7%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3,-2.72]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e287\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e4.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e95.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e78.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.17\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e95%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e14.2%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e(-3.52,-3]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e292\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2.7%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e97.2%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e89.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.08\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e97%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e13.0%\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e[-5.27,-3.52]\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e300\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e290\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e3.3%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e10.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e100.0%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e100.0%\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e100%\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e12.0%\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"interpretation\"\u003eInterpretation\u003c/h2\u003e\n\u003cp\u003eSome notes on how to interpret such a table:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSince scoring models aim to risk-rank borrowers, the first thing to look for is whether or not the event rates are consistently increasing  (or decreasing) across bins. If not, when using the actual model, one might not be able to confidently conclude if borrower A is better (or worse) than borrower B.\u003c/li\u003e\n\u003cli\u003eIf bin sizes are not consistent (in this case ~10%) it would imply that the model is assigning the same output/score to a lot of borrowers (clumping). This could pose issues later on (say when deciding cutoffs). The ideal solution is to add additional variables that can help differentiate between good and bad borrowers.\u003c/li\u003e\n\u003cli\u003eWhile the ideal cutoff would be the bin where the \u003ccode\u003eKS\u003c/code\u003e statistic is at its maximum, additional aspects like capture rates and approval rates should be taken into account.\u003c/li\u003e\n\u003cli\u003eTypically, analysts would look for a model which achieves the maximum value of the \u003ccode\u003eKS\u003c/code\u003e statistic within the first 2/3 deciles. That way, when creating underwriting policies, you would only end up rejecting 20%-30% of the applicant pool.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cem\u003eThoughts? Comments? Helpful? Not helpful? Like to see anything else added in here? Let me know!\u003c/em\u003e\u003c/p\u003e"
}
</script>

<link rel="preload" as="script" href="/bundle.js?v=1631939995">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://stats.g.doubleclick.net">
<link rel="preconnect" href="https://www.googleadservices.com">
<link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=UA-57026003-1">
<script src="https://www.googletagmanager.com/gtag/js?id=UA-57026003-1"></script>
<script>
  window.dataLayer=window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js',new Date());
  gtag('config','UA-57026003-1');
</script>

</head>
<body>

  <header id="nav" class="header">
  <div class="ax-l-i max-w-6xl">
    <div class="ax-logo">
      <a class="block" href="/" title="R&#39;tichoke"><span class="font-semibold text-raven-900">R'tichoke</span></a>
    </div>
    <div class="ax-user">
      <a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target="_blank" rel="noopener nofollow" href="https://www.google.com/search?q=site:https://rtichoke.netlify.app/" title="Search">
        <svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923l-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33 0 0 0 2.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg>

      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/about/">
        About
      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/post/">
        Posts
      </a>
    </div>
  </div>

  
</header>

  <main>
<div class="default-single">
  <div class="ax-title ax-l-o">
    <div class="ax-l-i max-w-4xl">
      <h1 class="post-title font-content-title font-normal leading-tight tracking-default text-40">Measuring model performance using a gains table</h1>
      <p class="post-subtitle font-content-sans font-light text-xl text-raven-500 mt-3">Credit risk series (Post #1)</p>

      <div class="ax-meta flex items-center mt-5">
        <div class="flex-grow min-w-0">
          <div class="flex items-center">
  
  <div class="flex-shrink-0">
    <img
    class="w-12 h-12 sm:w-14 sm:h-14 object-cover p-3px rounded-full border border-blue-300"
    src="data:image/svg&#43;xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzIgMzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI&#43;PHBhdGggZmlsbD0iI2VjZWZmMSIgZD0iTTAgMGgzMnYzMkgweiIvPjxwYXRoIGZpbGw9IiM0NTVhNjQiIGQ9Ik0yOS4zMDUgMjQuNDA3Yy0uNzk1LS42My0xLjc2NS0xLjA4LTIuODE2LTEuM0wyMS40NzYgMjIuMWExLjEzIDEuMTMgMCAwIDEtLjkwNS0xLjEydi0xLjE1Yy4zMjItLjQ1My42MjYtMS4wNTQuOTQ0LTEuNjgyLjI0Ny0uNDg3LjYyLTEuMjIuODA1LTEuNCAxLjAxNS0xLjAyIDEuOTk1LTIuMTY1IDIuMy0zLjY0LjI4My0xLjM4NS4wMDUtMi4xMTItLjMyMi0yLjY5NyAwLTEuNDYtLjA0Ni0zLjI5LS4zOS00LjYyLS4wNC0xLjgtLjM2OC0yLjgxNC0xLjE5LTMuNy0uNTgtLjYzLTEuNDM1LS43NzUtMi4xMjMtLjg5LS4yNy0uMDQ2LS42NDItLjEtLjc4LS4xODNDMTguNTk0LjM0NyAxNy40LjAyNSAxNS45NTIgMGMtMyAuMTIzLTYuNzEgMi4wNC03Ljk1IDUuNDU0LS4zODQgMS4wNC0uMzQ1IDIuNzQ3LS4zMTMgNC4xMmwtLjAzLjgyNWMtLjI5NS41NzYtLjU4NSAxLjMwNy0uMyAyLjY5Ny4zMDIgMS40OCAxLjI4MiAyLjYyNiAyLjMxNSAzLjY2LjE3LjE3NC41NS45MTQuODAyIDEuNDAzbC45NSAxLjY3NXYxLjE1YzAgLjU0Ni0uMzgyIDEuMDE3LS45IDEuMTJMNS41IDIzLjExYy0xLjA0NS4yMjItMi4wMTQuNjctMi44MDcgMS4yOThhMS4xNSAxLjE1IDAgMCAwLS40MjcuODA1IDEuMTQgMS4xNCAwIDAgMCAuMjkzLjg1OUM1Ljk3NSAyOS44MzggMTAuODczIDMyIDE2IDMyczEwLjAyNy0yLjE2IDEzLjQ0LTUuOTNhMS4xNCAxLjE0IDAgMCAwLS4xMzUtMS42NjR6Ii8&#43;PC9zdmc&#43;Cg=="
    alt="">
	</div>
    
  <div class="flex-shrink-0 ml-2 leading-tight font-content-sans">
    <a class="block text-sm text-raven-800 hover:text-raven-900 hover:underline focus:underline" target="_blank" rel="noopener nofollow" title="Riddhiman" href="https://linkedin.com/in/riddhimanr">Riddhiman</a>
    <time class="text-sm text-raven-500" datetime="2021-09-06T00:00:00Z">Sep 6, 2021</time>
  </div>
</div>

        </div>
        <div>
          

<div class="flex items-center">
    <a class="flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Measuring%20model%20performance%20using%20a%20gains%20table%20by%20%40%25%21s%28%3cnil%3e%29%20https%3a%2f%2frtichoke.netlify.app%2fpost%2fgains_table%2f"><svg class="w-6 h-6 fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg>
</a>
    <a class="ml-3 flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Facebook" href="https://www.facebook.com/dialog/share?app_id=&display=page&href=https%3a%2f%2frtichoke.netlify.app%2fpost%2fgains_table%2f"><svg class="w-6 h-6 fill-current" viewBox="-7 -3.5 39 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M30.234 0H1.765C.8.001 0 .79 0 1.766v28.47C.001 31.2.79 32 1.766 32h15.328V19.625h-4.156V14.78h4.156v-3.564c0-4.134 2.523-6.384 6.21-6.384 1.766 0 3.284.13 3.726.2v4.32h-2.543c-2.006 0-2.394.953-2.394 2.352v3.085h4.797l-.625 4.844h-4.172V32h8.14C31.21 32 32 31.2 32 30.234V1.765C32 .8 31.21 0 30.234 0z"/></svg>
</a>
  
</div>
        </div>
      </div>
    </div>
  </div><div class="ax-content ax-l-o">
    <div class="ax-l-i max-w-4xl">
      <article class="cdata">
<p>Modellers/analysts developing credit scores generally use something known as the <code>gains table</code> (or a <code>ks table</code>) to measure and quantify the performance of such models. We&rsquo;ll explore how to build such a table in this post.</p>
<p>The idea is to first discretise the population under consideration (say the testing or validation set) into groups based on the model&rsquo;s output (probability/log odds/scores). Typically, this is done in a way such that each group represents 10% of the total population (or deciles). Then, summary statistics are generated for each group and  cumulative distributions of events and non-events are analysed and the model&rsquo;s performance is quantified.</p>
<p>We&rsquo;ll use <code>dplyr</code> in this post. Doing it this way is nice since it&rsquo;s easier to read and the code would need minimal changes if using <code>sparklyr</code> (say within a big data environment where one might need to run this directly on a <em>hadoop</em> table).</p>
<h2 id="packages">Packages</h2>
<p>Let&rsquo;s get package installation out of the way first.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Pacman is a package management tool </span>
<span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;pacman&#34;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(pacman)
<span style="color:#75715e">## Warning: package &#39;pacman&#39; was built under R version 4.1.1</span>

<span style="color:#75715e"># p_load automatically installs packages if needed</span>
<span style="color:#a6e22e">p_load</span>(dplyr, magrittr, knitr, scales)
</code></pre></div><h2 id="sample-dataset">Sample dataset</h2>
<p><a href="https://github.com/royr2/blog/blob/main/download/credit_sample.csv">Here&rsquo;s</a> some sample data to play around with. The data set is small sample of the <strong>Lending Club</strong> dataset available on <a href="https://www.kaggle.com/wordsforthewise/lending-club">Kaggle</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sample <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.csv</span>(<span style="color:#e6db74">&#34;credit_sample.csv&#34;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">dim</span>(sample)
<span style="color:#75715e">## [1] 10000   153</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">class</span>(sample)
<span style="color:#75715e">## [1] &#34;data.frame&#34;</span>
</code></pre></div><h2 id="defining-a-target">Defining a target</h2>
<p>First, we need to create a target (outcome) to model for. Since this is a credit risk use case, we are looking to create a target which identifies borrowers who defaulted on (or missed) their payments consecutively.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">unique</span>(sample<span style="color:#f92672">$</span>loan_status)
<span style="color:#75715e">## [1] &#34;Fully Paid&#34;                                         </span>
<span style="color:#75715e">## [2] &#34;Current&#34;                                            </span>
<span style="color:#75715e">## [3] &#34;Charged Off&#34;                                        </span>
<span style="color:#75715e">## [4] &#34;Late (31-120 days)&#34;                                 </span>
<span style="color:#75715e">## [5] &#34;Late (16-30 days)&#34;                                  </span>
<span style="color:#75715e">## [6] &#34;In Grace Period&#34;                                    </span>
<span style="color:#75715e">## [7] &#34;Does not meet the credit policy. Status:Fully Paid&#34; </span>
<span style="color:#75715e">## [8] &#34;Does not meet the credit policy. Status:Charged Off&#34;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># For simplicity we&#39;ll just use </span>
<span style="color:#75715e"># 1. &#34;Charged Off&#34;</span>
<span style="color:#75715e"># 2. &#34;Does not meet the credit policy. Status:Charged Off&#34;</span>
codes <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Charged Off&#34;</span>, <span style="color:#e6db74">&#34;Does not meet the credit policy. Status:Charged Off&#34;</span>)

<span style="color:#75715e"># For details on the %&lt;&gt;% operator please look at the </span>
<span style="color:#75715e"># documentation for the magrittr package. </span>
sample <span style="color:#f92672">%&lt;&gt;%</span> <span style="color:#a6e22e">mutate</span>(bad_flag <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>(loan_status <span style="color:#f92672">%in%</span> codes, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>))
</code></pre></div><p>Let&rsquo;s also check for overall event rates.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sample <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(events <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(bad_flag <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), 
            non_events <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(bad_flag <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(event_rate <span style="color:#f92672">=</span> events<span style="color:#f92672">/</span>(events <span style="color:#f92672">+</span> non_events))
<span style="color:#75715e">##   events non_events event_rate</span>
<span style="color:#75715e">## 1   1162       8838     0.1162</span>
</code></pre></div><h2 id="building-a-model">Building a model</h2>
<p>Next lets build a quick and dirty model, the output of which we will use to build the gains table.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Check out available features (not shown here for brevity)</span>
<span style="color:#a6e22e">colnames</span>(sample)
</code></pre></div><p>We&rsquo;ll need to do some data cleaning first.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Replace all NA values with a default value</span>
sample<span style="color:#a6e22e">[is.na</span>(sample)] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">-1</span>

sample <span style="color:#f92672">%&lt;&gt;%</span> 
  
  <span style="color:#75715e"># Remove cases where home ownership and payment plan are not reported</span>
  <span style="color:#a6e22e">filter</span>(<span style="color:#f92672">!</span> home_ownership <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;NONE&#34;</span>),
         pymnt_plan <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  
  <span style="color:#75715e"># Convert these two variables into factors</span>
  <span style="color:#a6e22e">mutate</span>(home_ownership <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(home_ownership), 
         pymnt_plan <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(pymnt_plan))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Train Test split</span>
idx <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sample</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(sample), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">nrow</span>(sample), replace <span style="color:#f92672">=</span> F)
train <span style="color:#f92672">&lt;-</span> sample[idx,]
test <span style="color:#f92672">&lt;-</span> sample[<span style="color:#f92672">-</span>idx,]
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">dim</span>(train)
<span style="color:#75715e">## [1] 6999  153</span>
<span style="color:#a6e22e">dim</span>(test)
<span style="color:#75715e">## [1] 3000  153</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Using a GLM model for simplicity</span>
mdl <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">glm</span>(
  formula <span style="color:#f92672">=</span> bad_flag <span style="color:#f92672">~</span> 
    loan_amnt <span style="color:#f92672">+</span> term <span style="color:#f92672">+</span> mths_since_last_delinq <span style="color:#f92672">+</span> total_pymnt <span style="color:#f92672">+</span> 
    home_ownership <span style="color:#f92672">+</span> acc_now_delinq <span style="color:#f92672">+</span> 
    inq_last_6mths <span style="color:#f92672">+</span> delinq_amnt <span style="color:#f92672">+</span> 
    mths_since_last_record <span style="color:#f92672">+</span> mths_since_recent_revol_delinq <span style="color:#f92672">+</span> 
    mths_since_last_major_derog <span style="color:#f92672">+</span> mths_since_recent_inq <span style="color:#f92672">+</span> 
    mths_since_recent_bc <span style="color:#f92672">+</span> num_accts_ever_120_pd,
  family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;binomial&#34;</span>, 
  data <span style="color:#f92672">=</span> train
)
</code></pre></div><p>While we are at it, let&rsquo;s also attach the model predictions to the test dataset.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">test<span style="color:#f92672">$</span>pred <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">predict</span>(mdl, newdata <span style="color:#f92672">=</span> test)
</code></pre></div><h2 id="creating-the-gains-table">Creating the Gains Table</h2>
<p>The table has a few important components:</p>
<ul>
<li>Bins in decreasing/increasing order of model output (probability/log odds/scores)</li>
<li>Population percentages contained in each bin</li>
<li>Observed event rates in each bin</li>
<li>Cumulative events and non events distributions</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Discretise predictions based on quantiles</span>
q <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">quantile</span>(test<span style="color:#f92672">$</span>pred, probs <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, length.out <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>))

<span style="color:#75715e"># Add bins to test dataset</span>
test<span style="color:#f92672">$</span>bins <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cut</span>(test<span style="color:#f92672">$</span>pred, breaks <span style="color:#f92672">=</span> q, include.lowest <span style="color:#f92672">=</span> T, right <span style="color:#f92672">=</span> T, ordered_result <span style="color:#f92672">=</span> T)
</code></pre></div><div class="flex items-center justify-center font-content-sans rounded bg-raven-100 px-4 py-4" role="alert">
  <span class="text-xs font-bold uppercase leading-none rounded-full text-raven-100 bg-raven-500 px-2 py-1 mr-3">info</span>
  <span class="font-semibold text-raven-700">Note that the output from cut is arranged in increasing order of value</span>
</div>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">levels</span>(test<span style="color:#f92672">$</span>bins)
<span style="color:#75715e">##  [1] &#34;[-5.27,-3.52]&#34; &#34;(-3.52,-3]&#34;    &#34;(-3,-2.72]&#34;    &#34;(-2.72,-2.48]&#34;</span>
<span style="color:#75715e">##  [5] &#34;(-2.48,-2.29]&#34; &#34;(-2.29,-2.1]&#34;  &#34;(-2.1,-1.89]&#34;  &#34;(-1.89,-1.65]&#34;</span>
<span style="color:#75715e">##  [9] &#34;(-1.65,-1.29]&#34; &#34;(-1.29,12.8]&#34;</span>
</code></pre></div><p>Using the bins we created above, we can now start to put the table together</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Start with the test dataset and summarise</span>
gains_table <span style="color:#f92672">&lt;-</span> test <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">group_by</span>(bins) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(total <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>(), 
            events <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(bad_flag <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), 
            non_events <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(bad_flag <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>))
</code></pre></div><p>At this point the table should look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">kable</span>(gains_table)
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">bins</th>
<th style="text-align:right">total</th>
<th style="text-align:right">events</th>
<th style="text-align:right">non_events</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">[-5.27,-3.52]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">10</td>
<td style="text-align:right">290</td>
</tr>
<tr>
<td style="text-align:left">(-3.52,-3]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">8</td>
<td style="text-align:right">292</td>
</tr>
<tr>
<td style="text-align:left">(-3,-2.72]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">13</td>
<td style="text-align:right">287</td>
</tr>
<tr>
<td style="text-align:left">(-2.72,-2.48]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">20</td>
<td style="text-align:right">280</td>
</tr>
<tr>
<td style="text-align:left">(-2.48,-2.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">26</td>
<td style="text-align:right">274</td>
</tr>
<tr>
<td style="text-align:left">(-2.29,-2.1]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">37</td>
<td style="text-align:right">263</td>
</tr>
<tr>
<td style="text-align:left">(-2.1,-1.89]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">54</td>
<td style="text-align:right">246</td>
</tr>
<tr>
<td style="text-align:left">(-1.89,-1.65]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">57</td>
<td style="text-align:right">243</td>
</tr>
<tr>
<td style="text-align:left">(-1.65,-1.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">64</td>
<td style="text-align:right">236</td>
</tr>
<tr>
<td style="text-align:left">(-1.29,12.8]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">71</td>
<td style="text-align:right">229</td>
</tr>
</tbody>
</table>
<p>Next, we&rsquo;ll add the event rate columns. Let&rsquo;s also make the table presentable - I&rsquo;ll use the <code>percent()</code> function in the <code>scales</code> package to show numbers as percentages.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gains_table <span style="color:#f92672">%&lt;&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(event_rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(events <span style="color:#f92672">/</span> total, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>))

<span style="color:#a6e22e">kable</span>(gains_table)
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">bins</th>
<th style="text-align:right">total</th>
<th style="text-align:right">events</th>
<th style="text-align:right">non_events</th>
<th style="text-align:left">event_rate</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">[-5.27,-3.52]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">10</td>
<td style="text-align:right">290</td>
<td style="text-align:left">3.3%</td>
</tr>
<tr>
<td style="text-align:left">(-3.52,-3]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">8</td>
<td style="text-align:right">292</td>
<td style="text-align:left">2.7%</td>
</tr>
<tr>
<td style="text-align:left">(-3,-2.72]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">13</td>
<td style="text-align:right">287</td>
<td style="text-align:left">4.3%</td>
</tr>
<tr>
<td style="text-align:left">(-2.72,-2.48]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">20</td>
<td style="text-align:right">280</td>
<td style="text-align:left">6.7%</td>
</tr>
<tr>
<td style="text-align:left">(-2.48,-2.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">26</td>
<td style="text-align:right">274</td>
<td style="text-align:left">8.7%</td>
</tr>
<tr>
<td style="text-align:left">(-2.29,-2.1]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">37</td>
<td style="text-align:right">263</td>
<td style="text-align:left">12.3%</td>
</tr>
<tr>
<td style="text-align:left">(-2.1,-1.89]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">54</td>
<td style="text-align:right">246</td>
<td style="text-align:left">18.0%</td>
</tr>
<tr>
<td style="text-align:left">(-1.89,-1.65]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">57</td>
<td style="text-align:right">243</td>
<td style="text-align:left">19.0%</td>
</tr>
<tr>
<td style="text-align:left">(-1.65,-1.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">64</td>
<td style="text-align:right">236</td>
<td style="text-align:left">21.3%</td>
</tr>
<tr>
<td style="text-align:left">(-1.29,12.8]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">71</td>
<td style="text-align:right">229</td>
<td style="text-align:left">23.7%</td>
</tr>
</tbody>
</table>
<p>To this we&rsquo;ll add some columns quantifying how events and non events are distributed across each bin.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gains_table <span style="color:#f92672">%&lt;&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(pop_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(total<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(total), <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>), 
         
         <span style="color:#75715e"># Not formatting these as percentages just yet</span>
         c.events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">cumsum</span>(events) <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(events),
         c.non_events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">cumsum</span>(non_events) <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(non_events))

<span style="color:#a6e22e">kable</span>(gains_table) 
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">bins</th>
<th style="text-align:right">total</th>
<th style="text-align:right">events</th>
<th style="text-align:right">non_events</th>
<th style="text-align:left">event_rate</th>
<th style="text-align:left">pop_pct</th>
<th style="text-align:right">c.events_pct</th>
<th style="text-align:right">c.non_events_pct</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">[-5.27,-3.52]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">10</td>
<td style="text-align:right">290</td>
<td style="text-align:left">3.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.0277778</td>
<td style="text-align:right">0.1098485</td>
</tr>
<tr>
<td style="text-align:left">(-3.52,-3]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">8</td>
<td style="text-align:right">292</td>
<td style="text-align:left">2.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.0500000</td>
<td style="text-align:right">0.2204545</td>
</tr>
<tr>
<td style="text-align:left">(-3,-2.72]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">13</td>
<td style="text-align:right">287</td>
<td style="text-align:left">4.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.0861111</td>
<td style="text-align:right">0.3291667</td>
</tr>
<tr>
<td style="text-align:left">(-2.72,-2.48]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">20</td>
<td style="text-align:right">280</td>
<td style="text-align:left">6.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.1416667</td>
<td style="text-align:right">0.4352273</td>
</tr>
<tr>
<td style="text-align:left">(-2.48,-2.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">26</td>
<td style="text-align:right">274</td>
<td style="text-align:left">8.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.2138889</td>
<td style="text-align:right">0.5390152</td>
</tr>
<tr>
<td style="text-align:left">(-2.29,-2.1]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">37</td>
<td style="text-align:right">263</td>
<td style="text-align:left">12.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.3166667</td>
<td style="text-align:right">0.6386364</td>
</tr>
<tr>
<td style="text-align:left">(-2.1,-1.89]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">54</td>
<td style="text-align:right">246</td>
<td style="text-align:left">18.0%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.4666667</td>
<td style="text-align:right">0.7318182</td>
</tr>
<tr>
<td style="text-align:left">(-1.89,-1.65]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">57</td>
<td style="text-align:right">243</td>
<td style="text-align:left">19.0%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.6250000</td>
<td style="text-align:right">0.8238636</td>
</tr>
<tr>
<td style="text-align:left">(-1.65,-1.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">64</td>
<td style="text-align:right">236</td>
<td style="text-align:left">21.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">0.8027778</td>
<td style="text-align:right">0.9132576</td>
</tr>
<tr>
<td style="text-align:left">(-1.29,12.8]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">71</td>
<td style="text-align:right">229</td>
<td style="text-align:left">23.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:right">1.0000000</td>
<td style="text-align:right">1.0000000</td>
</tr>
</tbody>
</table>
<p>Almost done - just need a few more columns namely:</p>
<ul>
<li>A column computing the difference between the two cumulative distribution columns we created previously. The maximum value of this column will become the primary performance metric known as the <code>KS statistic</code>.</li>
<li>Two additional columns computing <code>event capture rates</code> and <code>cumulative event rates</code>.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gains_table <span style="color:#f92672">%&lt;&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(ks <span style="color:#f92672">=</span> <span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">abs</span>(c.events_pct <span style="color:#f92672">-</span> c.non_events_pct), <span style="color:#ae81ff">2</span>), 
         cap_rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(<span style="color:#a6e22e">cumsum</span>(events)<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(events), <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100</span>), 
         c_event_rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(<span style="color:#a6e22e">cumsum</span>(events)<span style="color:#f92672">/</span><span style="color:#a6e22e">cumsum</span>(total), <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>), 
         
         <span style="color:#75715e"># Format pending columns</span>
         c.events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(c.events_pct, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>),
         c.non_events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(c.non_events_pct, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>))

<span style="color:#a6e22e">kable</span>(gains_table)
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">bins</th>
<th style="text-align:right">total</th>
<th style="text-align:right">events</th>
<th style="text-align:right">non_events</th>
<th style="text-align:left">event_rate</th>
<th style="text-align:left">pop_pct</th>
<th style="text-align:left">c.events_pct</th>
<th style="text-align:left">c.non_events_pct</th>
<th style="text-align:right">ks</th>
<th style="text-align:left">cap_rate</th>
<th style="text-align:left">c_event_rate</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">[-5.27,-3.52]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">10</td>
<td style="text-align:right">290</td>
<td style="text-align:left">3.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">2.8%</td>
<td style="text-align:left">11.0%</td>
<td style="text-align:right">0.08</td>
<td style="text-align:left">3%</td>
<td style="text-align:left">3.3%</td>
</tr>
<tr>
<td style="text-align:left">(-3.52,-3]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">8</td>
<td style="text-align:right">292</td>
<td style="text-align:left">2.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">5.0%</td>
<td style="text-align:left">22.0%</td>
<td style="text-align:right">0.17</td>
<td style="text-align:left">5%</td>
<td style="text-align:left">3.0%</td>
</tr>
<tr>
<td style="text-align:left">(-3,-2.72]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">13</td>
<td style="text-align:right">287</td>
<td style="text-align:left">4.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">8.6%</td>
<td style="text-align:left">32.9%</td>
<td style="text-align:right">0.24</td>
<td style="text-align:left">9%</td>
<td style="text-align:left">3.4%</td>
</tr>
<tr>
<td style="text-align:left">(-2.72,-2.48]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">20</td>
<td style="text-align:right">280</td>
<td style="text-align:left">6.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">14.2%</td>
<td style="text-align:left">43.5%</td>
<td style="text-align:right">0.29</td>
<td style="text-align:left">14%</td>
<td style="text-align:left">4.2%</td>
</tr>
<tr>
<td style="text-align:left">(-2.48,-2.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">26</td>
<td style="text-align:right">274</td>
<td style="text-align:left">8.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">21.4%</td>
<td style="text-align:left">53.9%</td>
<td style="text-align:right">0.33</td>
<td style="text-align:left">21%</td>
<td style="text-align:left">5.1%</td>
</tr>
<tr>
<td style="text-align:left">(-2.29,-2.1]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">37</td>
<td style="text-align:right">263</td>
<td style="text-align:left">12.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">31.7%</td>
<td style="text-align:left">63.9%</td>
<td style="text-align:right">0.32</td>
<td style="text-align:left">32%</td>
<td style="text-align:left">6.3%</td>
</tr>
<tr>
<td style="text-align:left">(-2.1,-1.89]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">54</td>
<td style="text-align:right">246</td>
<td style="text-align:left">18.0%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">46.7%</td>
<td style="text-align:left">73.2%</td>
<td style="text-align:right">0.27</td>
<td style="text-align:left">47%</td>
<td style="text-align:left">8.0%</td>
</tr>
<tr>
<td style="text-align:left">(-1.89,-1.65]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">57</td>
<td style="text-align:right">243</td>
<td style="text-align:left">19.0%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">62.5%</td>
<td style="text-align:left">82.4%</td>
<td style="text-align:right">0.20</td>
<td style="text-align:left">62%</td>
<td style="text-align:left">9.4%</td>
</tr>
<tr>
<td style="text-align:left">(-1.65,-1.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">64</td>
<td style="text-align:right">236</td>
<td style="text-align:left">21.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">80.3%</td>
<td style="text-align:left">91.3%</td>
<td style="text-align:right">0.11</td>
<td style="text-align:left">80%</td>
<td style="text-align:left">10.7%</td>
</tr>
<tr>
<td style="text-align:left">(-1.29,12.8]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">71</td>
<td style="text-align:right">229</td>
<td style="text-align:left">23.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">100.0%</td>
<td style="text-align:left">100.0%</td>
<td style="text-align:right">0.00</td>
<td style="text-align:left">100%</td>
<td style="text-align:left">12.0%</td>
</tr>
</tbody>
</table>
<h2 id="creating-a-function">Creating a function</h2>
<p>Finally, we can encapsulate all of the above code in a single function. Note that we actually do not need the full test/train dataset, just the actual classes and predicted outcomes (log odds/probability/score).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gains_table <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(act, pred, increasing <span style="color:#f92672">=</span> T, nBins <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>){
  
  q <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">quantile</span>(pred, probs <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, length.out <span style="color:#f92672">=</span> nBins <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))
  bins <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cut</span>(pred, breaks <span style="color:#f92672">=</span> q, include.lowest <span style="color:#f92672">=</span> T, right <span style="color:#f92672">=</span> T, ordered_result <span style="color:#f92672">=</span> T)
  
  df <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(act, pred, bins)
  
  df <span style="color:#f92672">%&gt;%</span> 
    
    <span style="color:#a6e22e">group_by</span>(bins) <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">summarise</span>(total <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>(), 
              events <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(act <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), 
              non_events <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(act <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">mutate</span>(event_rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(events <span style="color:#f92672">/</span> total, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>)) <span style="color:#f92672">%&gt;%</span> 
    
    <span style="color:#75715e"># This odd looking format is to ensure that the if-else </span>
    <span style="color:#75715e"># condition is part of the dplyr chain</span>
    {<span style="color:#a6e22e">if</span>(increasing <span style="color:#f92672">==</span> <span style="color:#66d9ef">TRUE</span>){
      <span style="color:#a6e22e">arrange</span>(., bins)
    }else{
      <span style="color:#a6e22e">arrange</span>(., <span style="color:#a6e22e">desc</span>(bins))
    }} <span style="color:#f92672">%&gt;%</span> 
    
    <span style="color:#a6e22e">mutate</span>(pop_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(total<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(total), <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>), 
           c.events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">cumsum</span>(events) <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(events),
           c.non_events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">cumsum</span>(non_events) <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(non_events), 
           ks <span style="color:#f92672">=</span> <span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">abs</span>(c.events_pct <span style="color:#f92672">-</span> c.non_events_pct), <span style="color:#ae81ff">2</span>), 
           cap_rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(<span style="color:#a6e22e">cumsum</span>(events)<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(events), <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100</span>), 
           c_event_rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(<span style="color:#a6e22e">cumsum</span>(events)<span style="color:#f92672">/</span><span style="color:#a6e22e">cumsum</span>(total), <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>), 
           c.events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(c.events_pct, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>),
           c.non_events_pct <span style="color:#f92672">=</span> <span style="color:#a6e22e">percent</span>(c.non_events_pct, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">100</span>))
}
</code></pre></div><p>It is worth noting here that since the capture rate is being computed from <strong>top to bottom</strong>, it is important that the table is arranged in an appropriate manner. That is, when modelling for <code>bads</code>, the table should be arrange in <strong>descending</strong> order of the model output (i.e. higher event rates at the top) and vice versa.</p>
<p>Also, if you are planning on using this with <code>sparklyr</code>, consider looking into the <code>ft_quantile_discretizer()</code> function. It would replace <code>cut()</code> here.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Test the function</span>
tab <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gains_table</span>(test<span style="color:#f92672">$</span>bad_flag, test<span style="color:#f92672">$</span>pred, F, <span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">kable</span>(tab)
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">bins</th>
<th style="text-align:right">total</th>
<th style="text-align:right">events</th>
<th style="text-align:right">non_events</th>
<th style="text-align:left">event_rate</th>
<th style="text-align:left">pop_pct</th>
<th style="text-align:left">c.events_pct</th>
<th style="text-align:left">c.non_events_pct</th>
<th style="text-align:right">ks</th>
<th style="text-align:left">cap_rate</th>
<th style="text-align:left">c_event_rate</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">(-1.29,12.8]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">71</td>
<td style="text-align:right">229</td>
<td style="text-align:left">23.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">19.7%</td>
<td style="text-align:left">8.7%</td>
<td style="text-align:right">0.11</td>
<td style="text-align:left">20%</td>
<td style="text-align:left">23.7%</td>
</tr>
<tr>
<td style="text-align:left">(-1.65,-1.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">64</td>
<td style="text-align:right">236</td>
<td style="text-align:left">21.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">37.5%</td>
<td style="text-align:left">17.6%</td>
<td style="text-align:right">0.20</td>
<td style="text-align:left">38%</td>
<td style="text-align:left">22.5%</td>
</tr>
<tr>
<td style="text-align:left">(-1.89,-1.65]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">57</td>
<td style="text-align:right">243</td>
<td style="text-align:left">19.0%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">53.3%</td>
<td style="text-align:left">26.8%</td>
<td style="text-align:right">0.27</td>
<td style="text-align:left">53%</td>
<td style="text-align:left">21.3%</td>
</tr>
<tr>
<td style="text-align:left">(-2.1,-1.89]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">54</td>
<td style="text-align:right">246</td>
<td style="text-align:left">18.0%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">68.3%</td>
<td style="text-align:left">36.1%</td>
<td style="text-align:right">0.32</td>
<td style="text-align:left">68%</td>
<td style="text-align:left">20.5%</td>
</tr>
<tr>
<td style="text-align:left">(-2.29,-2.1]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">37</td>
<td style="text-align:right">263</td>
<td style="text-align:left">12.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">78.6%</td>
<td style="text-align:left">46.1%</td>
<td style="text-align:right">0.33</td>
<td style="text-align:left">79%</td>
<td style="text-align:left">18.9%</td>
</tr>
<tr>
<td style="text-align:left">(-2.48,-2.29]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">26</td>
<td style="text-align:right">274</td>
<td style="text-align:left">8.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">85.8%</td>
<td style="text-align:left">56.5%</td>
<td style="text-align:right">0.29</td>
<td style="text-align:left">86%</td>
<td style="text-align:left">17.2%</td>
</tr>
<tr>
<td style="text-align:left">(-2.72,-2.48]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">20</td>
<td style="text-align:right">280</td>
<td style="text-align:left">6.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">91.4%</td>
<td style="text-align:left">67.1%</td>
<td style="text-align:right">0.24</td>
<td style="text-align:left">91%</td>
<td style="text-align:left">15.7%</td>
</tr>
<tr>
<td style="text-align:left">(-3,-2.72]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">13</td>
<td style="text-align:right">287</td>
<td style="text-align:left">4.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">95.0%</td>
<td style="text-align:left">78.0%</td>
<td style="text-align:right">0.17</td>
<td style="text-align:left">95%</td>
<td style="text-align:left">14.2%</td>
</tr>
<tr>
<td style="text-align:left">(-3.52,-3]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">8</td>
<td style="text-align:right">292</td>
<td style="text-align:left">2.7%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">97.2%</td>
<td style="text-align:left">89.0%</td>
<td style="text-align:right">0.08</td>
<td style="text-align:left">97%</td>
<td style="text-align:left">13.0%</td>
</tr>
<tr>
<td style="text-align:left">[-5.27,-3.52]</td>
<td style="text-align:right">300</td>
<td style="text-align:right">10</td>
<td style="text-align:right">290</td>
<td style="text-align:left">3.3%</td>
<td style="text-align:left">10.0%</td>
<td style="text-align:left">100.0%</td>
<td style="text-align:left">100.0%</td>
<td style="text-align:right">0.00</td>
<td style="text-align:left">100%</td>
<td style="text-align:left">12.0%</td>
</tr>
</tbody>
</table>
<h2 id="interpretation">Interpretation</h2>
<p>Some notes on how to interpret such a table:</p>
<ul>
<li>Since scoring models aim to risk-rank borrowers, the first thing to look for is whether or not the event rates are consistently increasing  (or decreasing) across bins. If not, when using the actual model, one might not be able to confidently conclude if borrower A is better (or worse) than borrower B.</li>
<li>If bin sizes are not consistent (in this case ~10%) it would imply that the model is assigning the same output/score to a lot of borrowers (clumping). This could pose issues later on (say when deciding cutoffs). The ideal solution is to add additional variables that can help differentiate between good and bad borrowers.</li>
<li>While the ideal cutoff would be the bin where the <code>KS</code> statistic is at its maximum, additional aspects like capture rates and approval rates should be taken into account.</li>
<li>Typically, analysts would look for a model which achieves the maximum value of the <code>KS</code> statistic within the first 2/3 deciles. That way, when creating underwriting policies, you would only end up rejecting 20%-30% of the applicant pool.</li>
</ul>
<p><em>Thoughts? Comments? Helpful? Not helpful? Like to see anything else added in here? Let me know!</em></p>

      </article>
      

      
<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
  this.page.url = "https://rtichoke.netlify.app/post/gains_table/";
  this.page.identifier = "1af44154b88b325c4a43dfa46d3da497";
  this.page.title = "Measuring model performance using a gains table";
};

(function() {
  window.setTimeout(function() {
    var d = document;
    var s = d.createElement('script');
    s.src = 'https://rtichoke.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    s.setAttribute("defer", "");
    d.body.appendChild(s);
  }, 2500);
})();
</script>

    </div>
  </div>
</div>

  </main>
  <footer class="footer">
  <div class="ax-l-i max-w-6xl">
    <nav class="flex items-center justify-center">
    </nav>
    <div class="footer-social flex items-center justify-center mt-4">
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Twitter" href="https://twitter.com/r0yr2"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a>
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="GitHub" href="https://github.com/royr2"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M15.998 0C7.164 0 0 7.35 0 16.417 0 23.67 4.584 29.82 10.944 31.994c.8.15 1.092-.356 1.092-.79l-.022-2.792c-4.45.99-5.4-2.202-5.4-2.202-.726-1.896-1.776-2.4-1.776-2.4-1.454-1.018.108-.998.108-.998 1.606.117 2.45 1.693 2.45 1.693 1.428 2.507 3.746 1.784 4.658 1.363.144-1.06.558-1.784 1.016-2.195-3.552-.415-7.288-1.823-7.288-8.113 0-1.792.624-3.258 1.648-4.406-.166-.415-.714-2.085.156-4.344 0 0 1.344-.44 4.4 1.683 1.276-.364 2.644-.546 4.006-.552a14.98 14.98 0 0 1 4.006.554C23.062 6.37 24.404 6.8 24.404 6.8c.872 2.26.324 3.93.16 4.344 1.026 1.148 1.644 2.614 1.644 4.406 0 6.306-3.74 7.694-7.304 8.1.574.507 1.086 1.51 1.086 3.04l-.02 4.503c0 .44.288.95 1.1.788C27.42 29.817 32 23.667 32 16.417 32 7.35 24.836 0 15.998 0z"/></svg></a>
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="LinkedIn" href="https://www.linkedin.com/in/riddhimanr"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M29.692 0H2.308A2.31 2.31 0 0 0 0 2.308v27.384A2.31 2.31 0 0 0 2.308 32h27.384A2.31 2.31 0 0 0 32 29.692V2.308A2.31 2.31 0 0 0 29.692 0zM11.35 24.188H7.454V12.464h3.897v11.723zM9.402 10.863h-.025c-1.308 0-2.153-.9-2.153-2.025 0-1.15.872-2.026 2.205-2.026s2.153.875 2.18 2.026c0 1.125-.846 2.025-2.205 2.025zm16 13.324h-3.896v-6.272c0-1.576-.564-2.65-1.974-2.65-1.076 0-1.717.725-2 1.425-.103.25-.128.6-.128.95v6.547h-3.896V12.464h3.896v1.66c.518-.8 1.444-1.935 3.512-1.935 2.564 0 4.486 1.676 4.486 5.276v6.722z"/></svg></a>
    </div>

    <div class="footer-copyright text-sm text-center text-gray-400 mt-4">
      &#169; 2020-2021 R&#39;tichoke
    </div>
    <div class="text-sm sm:text-xs text-center text-gray-400 mt-2">
      Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a>
    </div>
  </div>
</footer>

<script src="/bundle.js?v=1631939995"></script>


</body>
</html>
